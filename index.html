<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GTAC VCE301 Student Logbook</title>

    <style>
      body {
        font-family: Figtree, sans-serif;
        text-align: center;
        margin: 20px;
      }

      .sidebar {
        position: fixed;
        top: 40px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .sidebar button {
        padding: 10px;
        cursor: pointer;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
      }
      .container {
        max-width: 800px;
        margin: 20px;
      }
      .investigation {
        margin-bottom: 50px;
      }
      .image-container {
        max-width: 80%;
        height: auto;
        margin-top: 20px;
      }
      textarea {
        width: 100%;
        height: 100px;
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <br /><br /><br />
      <img
        src="https://gtac.edu.au/wp-content/themes/gtac/assets/images/logo-2024.png"
        id="logoImage"
        style="width: 40%; opacity: 0.5"
      />
      <button onclick="scrollToSection('exp1')">Investigation 1</button>
      <button onclick="scrollToSection('exp2')">Investigation 2</button>
      <button onclick="scrollToSection('exp3')">Investigation 3</button>
      <button onclick="printPageAsPDF()">Save as PDF</button>
    </div>

    <div class="container">
      <h1 style="text-align: center">
        Applying Biotechnologies to Produce Human Insulin at GTAC
      </h1>

      <h2>Enter Your Names:</h2>
      <textarea id="experiment1" placeholder="Type your names here"></textarea>

      <img
        src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/recombinantplasmid?v=1738712387414"
        alt="Process of transforming bacteria with recombinant plasmid"
        style="width: 100%"
      />

      <div id="exp1" class="experiment active">
        <h2>Investigation 1: Plasmid Diagnostics</h2>
        <h3>
          Learning intention: To analyse restriction digest results using DNA
          gel electrophoresis.
        </h3>
        <img
          src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/orivsrecombinantplasmidmap?v=1738715311314"
          alt="Plasmid map comparison"
          style="width: 100%"
        />
        <h4>
          Identify 4 differences between the Original and the Recombinant
          Plasmid Maps
        </h4>
        <textarea
          id="experiment2"
          placeholder="List 4 differences as you compare the Original and the Recombinant Plasmid Maps"
        ></textarea>

        <title>Results: Modelling Double digest on plasmids</title>
        <style>
          table {
            width: 100%;
            border-collapse: collapse;
          }
          th,
          td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
          }
          th {
            background-color: #f2f2f2;
          }
          td[contenteditable="true"] {
            background-color: #eaf7ff;
          }
        </style>

        <body>
          <h2>Results: Modelling Double digest on plasmids</h2>
          <table>
            <tr>
              <th></th>
              <th colspan="2">Original Plasmid (4641 bp)</th>
              <th colspan="2">Recombinant Plasmid (5428 bp)</th>
            </tr>
            <tr>
              <td>Enzyme pair used for digest:</td>
              <td>Number of fragments</td>
              <td>Sizes of fragments (bp)</td>
              <td>Number of fragments</td>
              <td>Sizes of fragments (bp)</td>
            </tr>
            <tr>
              <td>
                EcoRV
                <div>NheI</div>
              </td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
            </tr>
            <tr>
              <td>
                EcoRV
                <div>XhoI</div>
              </td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
            </tr>
            <tr>
              <td>
                NheI
                <div>SmaI</div>
              </td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
              <td contenteditable="true"></td>
            </tr>
          </table>
          <p>
            Ignore fragments if they are less than 30 bp â€“ they cannot be
            detected experimentally
          </p>
        </body>

        <h2>Modelling: Gel Electrophoresis</h2>
        <h4 style="color: #ff6d3a">
          Insert picture of your predicted eGel results.
        </h4>
        <p>
          Please open your Camera app, take your photo, then choose your file
          from Photo Library
        </p>
        <input
          type="file"
          accept="image/*"
          onchange="addUploadedImage(event, 'imageContainer1')"
        />
        <div id="imageContainer1" class="image-container"></div>
        <h3 style="color: #ff6d3a">
          Summarise what is occurring during Gel Electrophoresis
        </h3>
        <textarea
          id="experiment3"
          placeholder="Type your summary of gel electrophoresis here"
        ></textarea>
      </div>

      <h2>Results: Gel Electrophoresis</h2>
      <img
        src="https://cdn.glitch.global/fcc4e6ca-0f57-4233-b69a-10230c4b69f6/eGelloadedlanes?v=1738890443008"
        alt="Egel Lanes"
        style="width: 80%"
      />

      <h4 style="color: #ff6d3a">Insert picture of the eGel results</h4>
      <input
        type="file"
        accept="image/*"
        onchange="addUploadedImage(event, 'imageContainer2')"
      />

      <div id="imageContainer2" class="image-container"></div>
      <h2>Analysis: DNA Gel Electrophoresis results</h2>
      <h4>
        Identify the tube that contains the recombinant plasmids (Tube 1 or Tube
        2?).
        <div>Justify your answer.</div>
      </h4>
      <textarea id="experiment4" placeholder="Type your answer here"></textarea>

      <div id="exp2" class="experiment">
        <h2>Investigation 2: Bacterial Transformation</h2>
        <h3>
          Learning intention: To refine a lab protocol to transform bacteria
          with recombinant plasmids.
        </h3>
        <style>
          .image-container {
              display: flex;
              justify-content: img-align: center;
              gap: 10px; /* Adds space between images */
          }
          .image-container img {
              width: 48%; /* Adjust width to fit side by side */
              max-width: 800; /* Prevents images from getting too large */
              height: auto; /* Maintains aspect ratio */
              border-radius: 10px; /* Optional: Adds rounded corners */
              box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); /* Optional: Adds a shadow */
          }
        </style>
        <div class="image-container">
          <img
            src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/Investigation2?v=1738727664648"
            alt="Example Image"
          />
          <img
            src="https://cdn.glitch.global/fcc4e6ca-0f57-4233-b69a-10230c4b69f6/investigation2protocol?v=1738817484920"
            alt="Transformation Protocol"
          />
        </div>

        <h3>Method:</h3>
        <h3 style="color: #ff6d3a">Step 1: Making bacteria competent</h3>

        <img
          src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/competentbacteria?v=1738724782056"
          alt="Using CaCl2 to make bacteria competent"
          style="width: 100%"
        />

        <img
          src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/Cacl2%20conc%20graph.png?v=1738719272040"
          alt="CaCl2 graph"
          style="width: 100%"
        />
        <h5>
          Use this data to decide the Calcium chloride concentration that you
          will use with your bacteria
        </h5>
        <textarea
          id="experiment5"
          placeholder="Select the concentration of CaCl2 here. Describe why we use Calcium chloride"
        ></textarea>

        <h3 style="color: #ff6d3a">Step 2: Heat Shock</h3>
        <img
          src="https://cdn.glitch.global/bedc10a6-54ca-4681-bce3-e9149cb53de3/heatshock.png?v=1738726774760"
          alt="Heat Shock"
          style="width: 100%"
        />

        <h4>
          Select the temperature and time for heat shock using the provided data
        </h4>

        <textarea
          id="experiment6"
          placeholder="Type your selected conditions for heat shock here"
        ></textarea>
        <div><h5>What is the purpose of heat shock?</h5></div>
        <textarea
          id="experiment7"
          placeholder="Type the purpose of heat shock here"
        ></textarea>
        <h3 style="color: #ff6d3a">Step 3: Recovery</h3>
        <h4>
          Use the data to determine the recovery time for your transformation
          protocol.
        </h4>
        <img
          src="https://cdn.glitch.global/fcc4e6ca-0f57-4233-b69a-10230c4b69f6/recoverytime?v=1738795693224"
          alt="Recovery Time graph"
          style="width: 100%"
        />
        <textarea
          id="experiment8"
          placeholder="Insert recovery time here"
        ></textarea>

        <div id="exp3" class="experiment">
          <h2>Investigation 3: Selecting for Transformed Bacteria</h2>
          <h3>
            Learning intention: To justify my selection of transformed bacteria
            for use in insulin production.
          </h3>
          <img
            src="https://cdn.glitch.global/fcc4e6ca-0f57-4233-b69a-10230c4b69f6/Investigation3Aim?v=1738817153606"
            alt="Investigation3Aim"
            style="width: 100%"
          />

          <div>
            <h5>
              Describe the purpose of GFP and a limitation of using it in
              bacterial tranformation.
            </h5>
          </div>
          <textarea
            id="experiment9"
            placeholder="Type your response here"
          ></textarea>

          <div>
            <h4>
              Hypothesis: How will you know that you have selected transformed
              bacteria?
            </h4>
          </div>
          <textarea
            id="experiment10"
            placeholder="It is expected that..."
          ></textarea>

          <h4>Modelling Activity: What is happening on each growth medium?</h4>
          <h5>Insert an image of your completed modelling activity here</h5>
          <input
            type="file"
            accept="image/*"
            onchange="addUploadedImage(event, 'imageContainer3')"
          />
          <div id="imageContainer3" class="image-container"></div>
          <h5>
            Using the model, summarise the purpose of the ingredients added to
            the growth media (LB/Ampicillin/Arabinose)
          </h5>
          <textarea
            id="experiment11"
            placeholder="Record the purpose of the ingredients in the growth media (LB, Ampicillin and arabinose sugar)"
          ></textarea>

          <h4>Results: Fluorescence microscopy</h4>
          <h5>
            Insert an image of your bacteria viewed through the Fluorescent
            microscope (EVOS)
          </h5>
          <input
            type="file"
            accept="image/*"
            onchange="addUploadedImage(event, 'imageContainer4')"
          />
          <div id="imageContainer4" class="image-container"></div>

          <h5>Insert an image of the sample answers to compare and discuss</h5>
          <input
            type="file"
            accept="image/*"
            onchange="addUploadedImage(event, 'imageContainer5')"
          />
          <div id="imageContainer5" class="image-container"></div>

          <h3>Discussion:</h3>
          <h5>Consider the following questions:</h5>
          <p style="text-align: left">
            1. What is the purpose of transforming bacteria?
            <br />
            2. What are some possible explanations for differences between the
            results you might see back at school? <br />
            i.e. Limitations and errors?
          </p>

          <textarea
            id="experiment12"
            placeholder="Type your response here"
          ></textarea>

          <h3>Conclusion (back at school):</h3>
          <textarea
            id="experiment13"
            placeholder="Write your conclusions here"
          ></textarea>
        </div>
      </div>
    </div>

    <script>
      const TWELVE_HOURS = 12 * 60 * 60 * 1000;
      // ------------------------------------------------------------------------
      // Scroll to Section Function
      // ------------------------------------------------------------------------
      function scrollToSection(sectionId) {
        document
          .getElementById(sectionId)
          .scrollIntoView({ behavior: "smooth" });
      }

      const DB_NAME = "imageStore";
      const DB_VERSION = 1;
      const IMAGE_EXPIRY = 12 * 60 * 60 * 1000; // 12 hours in milliseconds

      // Open IndexedDB
      function openDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);
          request.onupgradeneeded = function (event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains("images")) {
              db.createObjectStore("images", { keyPath: "id" });
            }
          };
          request.onsuccess = function (event) {
            resolve(event.target.result);
          };
          request.onerror = function (event) {
            reject("Error opening database:", event.target.error);
          };
        });
      }

      // Save Image to IndexedDB
      function saveImageToDB(containerId, imageData) {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");
          const imageEntry = {
            id: containerId,
            image: imageData,
            timestamp: Date.now(),
          };
          store.put(imageEntry);
        });
      }

      // Retrieve and Restore Images from IndexedDB
      function restoreImagesFromDB() {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readonly");
          const store = transaction.objectStore("images");
          const request = store.getAll();

          request.onsuccess = function () {
            const images = request.result;
            const currentTime = Date.now();
            images.forEach((imageEntry) => {
              if (currentTime - imageEntry.timestamp <= IMAGE_EXPIRY) {
                displayImage(imageEntry.image, imageEntry.id);
              } else {
                // Remove expired images
                removeImageFromDB(imageEntry.id);
              }
            });
          };
        });
      }

      // Remove Image from IndexedDB
      function removeImageFromDB(containerId) {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");
          store.delete(containerId);
        });
      }

      // Function to Display Image in its Container
      function displayImage(imageData, containerId) {
        const container = document.getElementById(containerId);
        if (container) {
          const image = document.createElement("img");
          image.src = imageData;
          image.style.maxWidth = "100%";
          container.innerHTML = "";
          container.appendChild(image);
        }
      }

      // Modified Upload Image Function to Store in IndexedDB
      function addUploadedImage(event, containerId) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const imageData = e.target.result;
            saveImageToDB(containerId, imageData); // Store image
            displayImage(imageData, containerId); // Display image
          };
          reader.readAsDataURL(file);
        }
      }

      // Restore Images on Page Load
      document.addEventListener("DOMContentLoaded", function () {
        restoreImagesFromDB();
      });

      // ------------------------------------------------------------------------
      // Print Page as PDF
      // ------------------------------------------------------------------------
      function printPageAsPDF() {
        window.print();
      }

      // ------------------------------------------------------------------------
      // Save and Restore (Session and Local Storage)
      // ------------------------------------------------------------------------
      document.addEventListener("DOMContentLoaded", function () {
        // Restore text areas from Session Storage on page load
        document.querySelectorAll("textarea").forEach((textarea) => {
          const savedText = sessionStorage.getItem(textarea.id);
          if (savedText !== null) {
            textarea.value = savedText;
          }
          // Save changes to both Session Storage and Local Storage
          textarea.addEventListener("input", () => {
            sessionStorage.setItem(textarea.id, textarea.value);
            // Local Storage now includes a timestamp
            const dataToStore = {
              value: textarea.value,
              timestamp: Date.now(),
            };
            localStorage.setItem(textarea.id, JSON.stringify(dataToStore));
          });
        });

        // Restore editable table cells from Session Storage on page load
        const editableCells = document.querySelectorAll(
          "td[contenteditable=true]"
        );
        editableCells.forEach((cell, index) => {
          const savedCellText = sessionStorage.getItem(`cell-${index}`);
          if (savedCellText !== null) {
            cell.innerText = savedCellText;
          }
          // Save changes to both Session Storage and Local Storage
          cell.addEventListener("input", () => {
            sessionStorage.setItem(`cell-${index}`, cell.innerText);
            // Save to Local Storage with timestamp
            const dataToStore = {
              value: cell.innerText,
              timestamp: Date.now(),
            };
            localStorage.setItem(`cell-${index}`, JSON.stringify(dataToStore));
          });
        });

        // Restore the uploaded image from Session Storage if desired (not strictly required, but included here)
        const uploadedImage = document.getElementById("uploadedImage");
        if (uploadedImage) {
          const savedImageData = sessionStorage.getItem("uploadedImage");
          if (savedImageData) {
            uploadedImage.src = savedImageData;
            uploadedImage.style.display = "block";
          }
        }
      });

      // ------------------------------------------------------------------------
      // Triple Click Detection for Logo
      // ------------------------------------------------------------------------
      let clickCount = 0;
      let firstClickTime = 0;

      document
        .getElementById("logoImage")
        .addEventListener("click", detectTripleClick);

      function detectTripleClick() {
        const currentTime = new Date().getTime();

        // If no clicks yet, initialize
        if (clickCount === 0) {
          clickCount = 1;
          firstClickTime = currentTime;
        } else {
          // If current time is still within 1 second of the first click
          if (currentTime - firstClickTime <= 1000) {
            clickCount++;
            // If we reach 3 clicks within 1 second, prompt for password
            if (clickCount === 3) {
              promptForPassword();
              // Reset click counter and time
              clickCount = 0;
              firstClickTime = 0;
            }
          } else {
            // More than 1 second has passed since the first click,
            // so reset and start over
            clickCount = 1;
            firstClickTime = currentTime;
          }
        }
      }

      // ------------------------------------------------------------------------
      // Prompt for Password
      // ------------------------------------------------------------------------
      function promptForPassword() {
        const userPassword = prompt("Please enter the password:");
        if (userPassword === "Abc") {
          showOverlay();
        }
      }

      function showOverlay() {
        document.getElementById("passwordOverlay").style.display = "flex";
      }

      function closeOverlay() {
        document.getElementById("passwordOverlay").style.display = "none";
      }

      function restoreLocalStorageData() {
        // Restore text areas from Local Storage
        document.querySelectorAll("textarea").forEach((textarea) => {
          const storedJson = localStorage.getItem(textarea.id);
          if (storedJson) {
            try {
              const parsed = JSON.parse(storedJson);
              if (Date.now() - parsed.timestamp <= TWELVE_HOURS) {
                // If it's less than 12 hours old, restore the value
                textarea.value = parsed.value;
              } else {
                // Otherwise, ignore or remove the stale data
                console.log(
                  `Data for ${textarea.id} is older than 12 hours; not restoring.`
                );
                // Optionally remove from Local Storage:
                // localStorage.removeItem(textarea.id);
              }
            } catch (e) {
              console.warn(
                `Invalid JSON in localStorage for ${textarea.id}`,
                e
              );
            }
          }
        });

        // Restore table cells from Local Storage
        document
          .querySelectorAll("td[contenteditable=true]")
          .forEach((cell, index) => {
            const storedJson = localStorage.getItem(`cell-${index}`);
            if (storedJson) {
              try {
                const parsed = JSON.parse(storedJson);
                if (Date.now() - parsed.timestamp <= TWELVE_HOURS) {
                  cell.innerText = parsed.value;
                } else {
                  console.log(
                    `Data for cell-${index} is older than 12 hours; not restoring.`
                  );
                  // localStorage.removeItem(`cell-${index}`);
                }
              } catch (e) {
                console.warn(
                  `Invalid JSON in localStorage for cell-${index}`,
                  e
                );
              }
            }
          });

        // Close the overlay as before
        closeOverlay();
      }
      // Function to restore a static image to the specified container
      function restoreImage(containerId, imageSrc) {
        const container = document.getElementById(containerId);
        if (container) {
          const image = document.createElement("img");
          image.src = imageSrc; // Path to the static image
          image.style.maxWidth = "100%";
          container.innerHTML = ""; // Clear any previous content
          container.appendChild(image);
        } else {
          console.error(`Container ${containerId} not found.`);
        }
      }

      // Function to Clear All Images from IndexedDB and UI
      function clearAllImages() {
        openDB().then((db) => {
          const transaction = db.transaction("images", "readwrite");
          const store = transaction.objectStore("images");
          store.clear(); // Clears all images from IndexedDB

          // Remove images from UI
          const imageContainers = [
            "imageContainer1",
            "imageContainer2",
            "imageContainer3",
            "imageContainer4",
            "imageContainer5",
          ];

          imageContainers.forEach((containerId) => {
            const container = document.getElementById(containerId);
            if (container) {
              container.innerHTML = ""; // Clears the image display
            }
          });

          alert("All stored images have been cleared!");
        });
      }
    </script>
    <!-- Overlay for Password-Protected Actions -->
    <div id="passwordOverlay" class="overlay">
      <div class="overlay-content">
        <span class="close-btn" onclick="closeOverlay()">&times;</span>
        <h2>Restore Panel</h2>
        <p>Click a button below to place example images or restore data.</p>

        <button onclick="restoreImage('imageContainer1', 'gelmodel.jpg')">
          Gel Model
        </button>
        <button onclick="restoreImage('imageContainer2', 'gelresult.jpg')">
          Gel Result
        </button>
        <button onclick="restoreImage('imageContainer3', 'growthmodel.jpg')">
          Bacterial Growth Model
        </button>
        <button onclick="restoreImage('imageContainer4', 'fluoro.jpg')">
          Fluorescent Bacteria
        </button>
        <button onclick="restoreImage('imageContainer5', 'sample.jpg')">
          Sample Result
        </button>
        <button onclick="clearAllImages()">Clear All Images (DANGER-CANNOT UNDO)</button>

        <hr />
        <button onclick="restoreLocalStorageData()">Restore Data</button>
      </div>
    </div>

    <style>
      /* Overlay Styling */
      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .overlay-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.3);
        width: 300px;
        position: relative;
      }

      .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
      }

      .overlay button {
        display: block;
        width: 100%;
        background: #007bff;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
      }

      .overlay hr {
        margin: 15px 0;
      }
    </style>
  </body>
</html>
